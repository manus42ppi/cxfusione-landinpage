<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CX Fusion ‚Äì Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --blue: #1a6cc8; --teal: #2ab5c8; --blue-deep: #0f3d7a;
  --text: #0d1b2e; --muted: #4a5f7a;
  --border: rgba(26,108,200,0.12); --off: #f4f7fc;
  --grad: linear-gradient(135deg, #0f3d7a, #1a6cc8, #2ab5c8);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'DM Sans',sans-serif; background:var(--off); color:var(--text); min-height:100vh; }

/* LOGIN */
#login-screen {
  position:fixed; inset:0; background:var(--grad);
  display:flex; align-items:center; justify-content:center; z-index:1000;
}
.login-box {
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:20px; padding:48px; width:100%; max-width:380px;
  backdrop-filter:blur(20px); text-align:center;
}
.login-logo {
  font-family:'Syne',sans-serif; font-size:24px; font-weight:800;
  color:#fff; margin-bottom:8px;
}
.login-logo span { color:#4ecde0; }
.login-sub { color:rgba(255,255,255,0.6); font-size:13px; margin-bottom:36px; }
.login-input {
  width:100%; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2);
  border-radius:8px; padding:14px 16px; color:#fff; font-size:15px;
  font-family:'DM Sans',sans-serif; outline:none; margin-bottom:12px;
  transition:border-color .2s;
}
.login-input::placeholder { color:rgba(255,255,255,0.4); }
.login-input:focus { border-color:rgba(42,181,200,0.6); }
.login-btn {
  width:100%; background:#fff; border:none; border-radius:8px;
  padding:14px; font-family:'Syne',sans-serif; font-weight:700;
  font-size:15px; color:var(--blue-deep); cursor:pointer; transition:all .2s;
}
.login-btn:hover { background:#4ecde0; color:#fff; }
.login-error { color:#ff8080; font-size:13px; margin-top:10px; display:none; }

/* ADMIN APP */
#admin-app { display:none; }

/* TOPBAR */
.topbar {
  background:var(--blue-deep); padding:0 28px; height:60px;
  display:flex; align-items:center; justify-content:space-between;
}
.topbar-logo {
  font-family:'Syne',sans-serif; font-size:18px; font-weight:800; color:#fff;
}
.topbar-logo span { color:#4ecde0; }
.topbar-right { display:flex; align-items:center; gap:16px; }
.topbar-tag {
  background:rgba(42,181,200,0.2); border:1px solid rgba(42,181,200,0.4);
  color:#4ecde0; padding:4px 12px; border-radius:4px; font-size:12px;
  letter-spacing:0.5px;
}
.logout-btn {
  background:none; border:1px solid rgba(255,255,255,0.2); color:rgba(255,255,255,0.6);
  padding:6px 14px; border-radius:6px; cursor:pointer; font-size:12px;
  font-family:'DM Sans',sans-serif; transition:all .2s;
}
.logout-btn:hover { border-color:rgba(255,255,255,0.5); color:#fff; }

/* MAIN LAYOUT */
.admin-main { max-width:1200px; margin:0 auto; padding:36px 28px; }
.admin-header { margin-bottom:36px; }
.admin-title {
  font-family:'Syne',sans-serif; font-size:28px; font-weight:800; margin-bottom:6px;
}
.admin-sub { color:var(--muted); font-size:14px; }

/* KPI CARDS */
.kpi-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin-bottom:36px; }
.kpi-card {
  background:#fff; border:1px solid var(--border); border-radius:14px; padding:24px;
  position:relative; overflow:hidden; transition:transform .2s, box-shadow .2s;
}
.kpi-card:hover { transform:translateY(-2px); box-shadow:0 10px 40px rgba(26,108,200,0.1); }
.kpi-card::before {
  content:''; position:absolute; top:0; left:0; right:0; height:3px;
  background:var(--grad);
}
.kpi-icon { font-size:24px; margin-bottom:12px; }
.kpi-num {
  font-family:'Syne',sans-serif; font-size:36px; font-weight:800;
  color:var(--blue); line-height:1;
}
.kpi-label { font-size:13px; color:var(--muted); margin-top:4px; }
.kpi-change { font-size:12px; margin-top:8px; }
.kpi-change.up { color:#28c878; }
.kpi-change.down { color:#ff5f57; }

/* PANELS */
.panels { display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-bottom:24px; }
.panel {
  background:#fff; border:1px solid var(--border); border-radius:14px; overflow:hidden;
}
.panel-header {
  padding:20px 24px; border-bottom:1px solid var(--border);
  display:flex; justify-content:space-between; align-items:center;
}
.panel-title { font-family:'Syne',sans-serif; font-weight:700; font-size:15px; }
.panel-body { padding:24px; }

/* LEADS TABLE */
.leads-panel { grid-column:1/-1; }
.table-wrap { overflow-x:auto; }
table { width:100%; border-collapse:collapse; font-size:13px; }
th {
  text-align:left; padding:10px 16px; background:var(--off);
  color:var(--muted); font-weight:500; font-size:11px;
  letter-spacing:1px; text-transform:uppercase; border-bottom:1px solid var(--border);
}
td { padding:12px 16px; border-bottom:1px solid var(--border); color:var(--text); }
tr:last-child td { border:none; }
tr:hover td { background:rgba(26,108,200,0.02); }
.source-badge {
  padding:3px 10px; border-radius:4px; font-size:11px; font-weight:600;
}
.source-hero { background:rgba(26,108,200,0.1); color:var(--blue); }
.source-bottom { background:rgba(42,181,200,0.1); color:var(--teal); }

/* CHART BARS */
.chart-bar-wrap { display:flex; flex-direction:column; gap:10px; }
.chart-bar-row { display:flex; align-items:center; gap:12px; font-size:13px; }
.chart-bar-label { width:80px; color:var(--muted); text-align:right; flex-shrink:0; font-size:12px; }
.chart-bar-track {
  flex:1; height:20px; background:var(--off); border-radius:4px; overflow:hidden;
}
.chart-bar-fill {
  height:100%; border-radius:4px;
  background:linear-gradient(90deg, var(--blue), var(--teal));
  transition:width .8s ease;
}
.chart-bar-val { width:40px; color:var(--blue); font-weight:600; font-size:13px; }

/* ACTIONS */
.action-bar {
  background:#fff; border:1px solid var(--border); border-radius:14px;
  padding:20px 24px; margin-bottom:24px;
  display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;
}
.action-bar-title { font-family:'Syne',sans-serif; font-weight:700; font-size:14px; }
.btn { padding:10px 20px; border-radius:8px; font-family:'DM Sans',sans-serif; font-weight:500; font-size:13px; cursor:pointer; border:none; transition:all .2s; }
.btn-primary { background:var(--blue); color:#fff; }
.btn-primary:hover { background:var(--blue-deep); }
.btn-outline { background:none; border:1px solid var(--border); color:var(--text); }
.btn-outline:hover { border-color:var(--blue); color:var(--blue); }
.btn-teal { background:var(--teal); color:#fff; }
.btn-teal:hover { background:#1fa3b5; }
.btn-group { display:flex; gap:10px; flex-wrap:wrap; }

/* EMPTY STATE */
.empty-state { text-align:center; padding:40px; color:var(--muted); }
.empty-icon { font-size:40px; margin-bottom:12px; }
.empty-text { font-size:14px; }

/* RESPONSIVE */
@media(max-width:900px) {
  .kpi-grid { grid-template-columns:1fr 1fr; }
  .panels { grid-template-columns:1fr; }
}
@media(max-width:600px) {
  .kpi-grid { grid-template-columns:1fr 1fr; }
  .admin-main { padding:20px 16px; }
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo"><span>CX</span> FUSION</div>
    <div class="login-sub">Admin Dashboard ¬∑ Bitte einloggen</div>
    <input type="password" id="pw-input" class="login-input" placeholder="Passwort" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">Einloggen</button>
    <div class="login-error" id="login-error">‚ùå Falsches Passwort</div>
  </div>
</div>

<!-- ADMIN APP -->
<div id="admin-app">
  <div class="topbar">
    <div class="topbar-logo"><span>CX</span> FUSION</div>
    <div class="topbar-right">
      <span class="topbar-tag">‚öô Admin Dashboard</span>
      <button class="logout-btn" onclick="doLogout()">Ausloggen</button>
    </div>
  </div>

  <div class="admin-main">
    <div class="admin-header">
      <h1 class="admin-title">Performance Overview</h1>
      <p class="admin-sub" id="last-updated">Letzte Aktualisierung: ‚Äî</p>
    </div>

    <!-- ACTION BAR -->
    <div class="action-bar">
      <div class="action-bar-title">üì§ Daten exportieren</div>
      <div class="btn-group">
        <button class="btn btn-teal" onclick="exportXML()">‚¨á XML exportieren</button>
        <button class="btn btn-outline" onclick="exportCSV()">‚¨á CSV exportieren</button>
        <button class="btn btn-outline" onclick="clearData()">üóë Daten l√∂schen</button>
        <button class="btn btn-primary" onclick="loadData()">‚Üª Aktualisieren</button>
      </div>
    </div>

    <!-- KPI CARDS -->
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-icon">üìß</div>
        <div class="kpi-num" id="kpi-leads">0</div>
        <div class="kpi-label">Gesammelte E-Mails</div>
        <div class="kpi-change up" id="kpi-leads-change"></div>
      </div>
      <div class="kpi-card">
        <div class="kpi-icon">üëÅ</div>
        <div class="kpi-num" id="kpi-views">0</div>
        <div class="kpi-label">Seitenaufrufe</div>
        <div class="kpi-change up" id="kpi-views-change"></div>
      </div>
      <div class="kpi-card">
        <div class="kpi-icon">üìä</div>
        <div class="kpi-num" id="kpi-conv">0%</div>
        <div class="kpi-label">Conversion Rate</div>
        <div class="kpi-change" id="kpi-conv-note" style="color:var(--muted)"></div>
      </div>
      <div class="kpi-card">
        <div class="kpi-icon">üåç</div>
        <div class="kpi-num" id="kpi-langs">‚Äî</div>
        <div class="kpi-label">Top Sprache</div>
        <div class="kpi-change" id="kpi-lang-split" style="color:var(--muted)"></div>
      </div>
    </div>

    <!-- CHARTS + SOURCES -->
    <div class="panels">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">üìà Leads nach Quelle</span>
        </div>
        <div class="panel-body">
          <div class="chart-bar-wrap" id="source-chart"></div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">üïí Leads nach Uhrzeit</span>
        </div>
        <div class="panel-body">
          <div class="chart-bar-wrap" id="time-chart"></div>
        </div>
      </div>
    </div>

    <!-- LEADS TABLE -->
    <div class="panel leads-panel">
      <div class="panel-header">
        <span class="panel-title">üìã Alle E-Mail-Leads</span>
        <span id="lead-count-label" style="font-size:13px;color:var(--muted)"></span>
      </div>
      <div class="panel-body">
        <div class="table-wrap">
          <table id="leads-table">
            <thead>
              <tr>
                <th>#</th>
                <th>E-Mail</th>
                <th>Datum</th>
                <th>Uhrzeit</th>
                <th>Sprache</th>
                <th>Quelle</th>
              </tr>
            </thead>
            <tbody id="leads-tbody"></tbody>
          </table>
          <div class="empty-state" id="leads-empty" style="display:none">
            <div class="empty-icon">üì≠</div>
            <div class="empty-text">Noch keine Leads gesammelt.<br>Besuche die Landing Page und trage eine E-Mail ein.</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
const ADMIN_PASSWORD = 'cxfusion2026';

function doLogin() {
  const pw = document.getElementById('pw-input').value;
  if (pw === ADMIN_PASSWORD) {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('admin-app').style.display = 'block';
    loadData();
  } else {
    const err = document.getElementById('login-error');
    err.style.display = 'block';
    setTimeout(() => err.style.display = 'none', 3000);
    document.getElementById('pw-input').value = '';
  }
}

function doLogout() {
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('admin-app').style.display = 'none';
  document.getElementById('pw-input').value = '';
}

function loadData() {
  const leads = JSON.parse(localStorage.getItem('cx_leads') || '[]');
  const views = JSON.parse(localStorage.getItem('cx_views') || '[]');

  document.getElementById('last-updated').textContent = 'Letzte Aktualisierung: ' + new Date().toLocaleString('de-DE');

  // KPIs
  document.getElementById('kpi-leads').textContent = leads.length;
  document.getElementById('kpi-views').textContent = views.length;

  const conv = views.length > 0 ? ((leads.length / views.length) * 100).toFixed(1) : '0.0';
  document.getElementById('kpi-conv').textContent = conv + '%';
  document.getElementById('kpi-conv-note').textContent = leads.length + ' Leads / ' + views.length + ' Views';

  // Lang split
  const deLangs = leads.filter(l => l.lang === 'de').length;
  const enLangs = leads.filter(l => l.lang === 'en').length;
  const topLang = deLangs >= enLangs ? 'Deutsch' : 'English';
  document.getElementById('kpi-langs').textContent = topLang;
  document.getElementById('kpi-lang-split').textContent = 'DE: ' + deLangs + ' | EN: ' + enLangs;

  // Today's counts
  const today = new Date().toDateString();
  const todayLeads = leads.filter(l => new Date(l.date).toDateString() === today).length;
  const todayViews = views.filter(v => new Date(v.date).toDateString() === today).length;
  document.getElementById('kpi-leads-change').textContent = '+' + todayLeads + ' heute';
  document.getElementById('kpi-views-change').textContent = '+' + todayViews + ' heute';

  // Source chart
  const heroCount = leads.filter(l => l.source === 'hero').length;
  const bottomCount = leads.filter(l => l.source === 'bottom').length;
  const maxS = Math.max(heroCount, bottomCount, 1);
  document.getElementById('source-chart').innerHTML = `
    <div class="chart-bar-row">
      <div class="chart-bar-label">Hero Form</div>
      <div class="chart-bar-track"><div class="chart-bar-fill" style="width:${(heroCount/maxS)*100}%"></div></div>
      <div class="chart-bar-val">${heroCount}</div>
    </div>
    <div class="chart-bar-row">
      <div class="chart-bar-label">Lead Form</div>
      <div class="chart-bar-track"><div class="chart-bar-fill" style="width:${(bottomCount/maxS)*100}%"></div></div>
      <div class="chart-bar-val">${bottomCount}</div>
    </div>
  `;

  // Time chart (by hour buckets)
  const buckets = { 'Morgens (6‚Äì12)': 0, 'Mittags (12‚Äì18)': 0, 'Abends (18‚Äì24)': 0, 'Nachts (0‚Äì6)': 0 };
  leads.forEach(l => {
    const h = new Date(l.date).getHours();
    if (h >= 6 && h < 12) buckets['Morgens (6‚Äì12)']++;
    else if (h >= 12 && h < 18) buckets['Mittags (12‚Äì18)']++;
    else if (h >= 18) buckets['Abends (18‚Äì24)']++;
    else buckets['Nachts (0‚Äì6)']++;
  });
  const maxT = Math.max(...Object.values(buckets), 1);
  document.getElementById('time-chart').innerHTML = Object.entries(buckets).map(([k, v]) => `
    <div class="chart-bar-row">
      <div class="chart-bar-label">${k.split(' ')[0]}</div>
      <div class="chart-bar-track"><div class="chart-bar-fill" style="width:${(v/maxT)*100}%"></div></div>
      <div class="chart-bar-val">${v}</div>
    </div>
  `).join('');

  // Leads table
  const tbody = document.getElementById('leads-tbody');
  const empty = document.getElementById('leads-empty');
  if (leads.length === 0) {
    tbody.innerHTML = '';
    empty.style.display = 'block';
  } else {
    empty.style.display = 'none';
    document.getElementById('lead-count-label').textContent = leads.length + ' Eintr√§ge';
    tbody.innerHTML = [...leads].reverse().map((l, i) => {
      const d = new Date(l.date);
      return `<tr>
        <td style="color:var(--muted)">${leads.length - i}</td>
        <td><strong>${escapeHtml(l.email)}</strong></td>
        <td>${d.toLocaleDateString('de-DE')}</td>
        <td>${d.toLocaleTimeString('de-DE', {hour:'2-digit',minute:'2-digit'})}</td>
        <td>${l.lang === 'de' ? 'üá©üá™ DE' : 'üá¨üáß EN'}</td>
        <td><span class="source-badge source-${l.source}">${l.source === 'hero' ? 'Hero' : 'Lead-Form'}</span></td>
      </tr>`;
    }).join('');
  }
}

function escapeHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function exportXML() {
  const leads = JSON.parse(localStorage.getItem('cx_leads') || '[]');
  const views = JSON.parse(localStorage.getItem('cx_views') || '[]');
  const conv = views.length > 0 ? ((leads.length / views.length) * 100).toFixed(2) : '0.00';

  let xml = `<?xml version="1.0" encoding="UTF-8"?>\n`;
  xml += `<cxfusion-analytics exported="${new Date().toISOString()}">\n`;
  xml += `  <summary>\n`;
  xml += `    <total-leads>${leads.length}</total-leads>\n`;
  xml += `    <total-views>${views.length}</total-views>\n`;
  xml += `    <conversion-rate>${conv}%</conversion-rate>\n`;
  xml += `    <export-date>${new Date().toISOString()}</export-date>\n`;
  xml += `  </summary>\n`;
  xml += `  <leads>\n`;
  leads.forEach((l, i) => {
    xml += `    <lead id="${i+1}">\n`;
    xml += `      <email>${escapeXml(l.email)}</email>\n`;
    xml += `      <date>${l.date}</date>\n`;
    xml += `      <language>${l.lang}</language>\n`;
    xml += `      <source>${l.source}</source>\n`;
    xml += `    </lead>\n`;
  });
  xml += `  </leads>\n`;
  xml += `  <pageviews>\n`;
  views.forEach((v, i) => {
    xml += `    <view id="${i+1}">\n`;
    xml += `      <date>${v.date}</date>\n`;
    xml += `      <referrer>${escapeXml(v.referrer)}</referrer>\n`;
    xml += `    </view>\n`;
  });
  xml += `  </pageviews>\n`;
  xml += `</cxfusion-analytics>`;

  downloadFile(xml, `cxfusion-leads-${formatDate()}.xml`, 'application/xml');
}

function exportCSV() {
  const leads = JSON.parse(localStorage.getItem('cx_leads') || '[]');
  let csv = 'ID,Email,Datum,Uhrzeit,Sprache,Quelle\n';
  leads.forEach((l, i) => {
    const d = new Date(l.date);
    csv += `${i+1},"${l.email}","${d.toLocaleDateString('de-DE')}","${d.toLocaleTimeString('de-DE')}","${l.lang}","${l.source}"\n`;
  });
  downloadFile(csv, `cxfusion-leads-${formatDate()}.csv`, 'text/csv');
}

function downloadFile(content, filename, type) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([content], {type}));
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

function escapeXml(str) {
  return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function formatDate() {
  return new Date().toISOString().slice(0,10);
}

function clearData() {
  if (confirm('Wirklich alle Leads und View-Daten l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!')) {
    localStorage.removeItem('cx_leads');
    localStorage.removeItem('cx_views');
    loadData();
  }
}

// Auto-refresh every 30s
setInterval(loadData, 30000);
</script>
</body>
</html>
